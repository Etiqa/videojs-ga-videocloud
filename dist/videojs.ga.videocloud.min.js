/*
* videojs-ga-videocloud - v0.4.2 - 2017-01-19
* Based on videojs-ga 0.4.2
* Copyright (c) 2017 Michael Bensoussan
* Licensed MIT
*/
(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};videojs.plugin("ga",function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;return null==b&&(b={}),A=document.createElement("a"),A.href=document.referrer,self!==top&&"preview-players.brightcove.net"===window.location.host&&"studio.brightcove.com"===A.hostname?void videojs.log("Google analytics plugin will not track events in Video Cloud Studio"):(x=this,f={},this.options()["data-setup"]&&(s=JSON.parse(this.options()["data-setup"]),s.ga&&(f=s.ga)),h=["player_load","video_load","percent_played","start","end","seek","play","pause","resize","volume_change","error","fullscreen"],n=b.eventsToTrack||f.eventsToTrack||h,v=b.percentsPlayedInterval||f.percentsPlayedInterval||10,c=b.ISIBehaviorEnabled||!1,k=b.eventCategory||f.eventCategory||"Brightcove Player",g=b.eventLabel||f.eventLabel,G=b.sendbeaconOverride||!1,b.debug=b.debug||!1,b.trackerName=b.trackerName||null,K="","string"==typeof b.trackerName&&(K=b.trackerName+"."),u=[],D=C=0,E=!1,l="",e="",y=0,z="",m={video_load:"Video Load",percent_played:"Percent played",start:"Media Begin",seek_start:"Seek start",seek_end:"Seek end",play:"Media Play",pause:"Media Pause",error:"Error",fullscreen_exit:"Fullscreen Exited",fullscreen_enter:"Fullscreen Entered",resize:"Resize",volume_change:"Volume Change",player_load:"Player Load",end:"Media Complete"},p=function(a){return b.eventNames&&b.eventNames[a]?b.eventNames[a]:f.eventNames&&f.eventNames[a]?f.eventNames[a]:m[a]?m[a]:a},("players.brightcove.net"===window.location.host||"preview-players.brightcove.net"===window.location.host||""!==K)&&(J=b.tracker||f.tracker,J&&(!function(a,b,c,d,e,f,g){return a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){return(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",J,"auto",b.trackerName),ga(K+"require","displayfeatures"))),d=/(\s|^)vjs-ad-(playing|loading)(\s|$)/,q=function(a){return d.test(a.el().className)},r=function(){q(x)||(L(),x.mediainfo&&x.mediainfo.id&&x.mediainfo.id!==e&&(e=x.mediainfo.id,u=[],D=C=0,E=!1,a.call(n,"video_load")>=0&&F(p("video_load"),!0)))},L=function(){return l=g?g:x.mediainfo&&x.mediainfo.id?x.mediainfo.id+" | "+x.mediainfo.name:this.currentSrc().split("/").slice(-1)[0].replace(/\.(\w{3,4})(\?.*)?$/i,"")},I=function(){var b,c,d,e,f;if(!q(x)){for(b=Math.round(this.currentTime()),c=Math.round(this.duration()),e=Math.round(b/c*100),d=f=0;99>=f;d=f+=v)e>=d&&a.call(u,d)<0&&(a.call(n,"percent_played")>=0&&0!==e&&F(p("percent_played")+"_"+d,!0,d),e>0&&u.push(d));a.call(n,"seek")>=0&&(D=C,C=b,Math.abs(D-C)>1&&(E=!0,z&&z!==l&&y>0&&y===D&&0===C?(y=0,z=""):(F(p("seek_start"),!1,D),F(p("seek_end"),!1,C))))}},i=function(){q(x)||(y=Math.round(this.duration()),z=l,F(p("end"),!0))},w=function(){var a;q(x)||(a=Math.round(this.currentTime()),L(),F(p("play"),!0,a),E=!1)},H=function(){return!q(x)&&a.call(n,"start")>=0?F(p("start"),!0):void 0},t=function(){var a,b;q(x)||(a=Math.round(this.currentTime()),b=Math.round(this.duration()),b-1>a&&!E&&F(p("pause"),!0,a))},M=function(){var a;a=this.muted()===!0?0:this.volume(),F(p("volume_change"),!1,a)},B=function(){F(p("resize")+" - "+this.width()+"*"+this.height(),!0)},j=function(){var a;a=Math.round(this.currentTime()),F(p("error"),!0,a)},o=function(){var a;a=Math.round(this.currentTime()),this.isFullscreen()?F(p("fullscreen_enter"),!1,a):F(p("fullscreen_exit"),!1,a)},F=function(a,c,d){G?G(k,a,l,d,c):window.ga?ga(K+"send","event",{eventCategory:k,eventAction:a,eventLabel:l,eventValue:d,nonInteraction:c}):window._gaq?_gaq.push(["_trackEvent",k,a,l,d,c]):b.debug&&videojs.log("Google Analytics not detected")},this.ready(function(){var b,d;return this.on("loadedmetadata",r),this.on("timeupdate",I),c?(this.on("actualPlay",w),a.call(n,"start")>=0&&this.on("actualPlaying",H)):(this.on("play",w),a.call(n,"start")>=0&&this.on("playing",H)),a.call(n,"end")>=0&&this.on("ended",i),a.call(n,"pause")>=0&&this.on("pause",t),a.call(n,"volume_change")>=0&&this.on("volumechange",M),a.call(n,"resize")>=0&&this.on("resize",B),a.call(n,"error")>=0&&this.on("error",j),a.call(n,"fullscreen")>=0&&this.on("fullscreenchange",o),a.call(n,"player_load")>=0?(self!==top?(b=document.referrer,d=1):(b=window.location.href,d=0),G?G(k,p("player_load"),b,d,!0):window.ga?ga(K+"send","event",{eventCategory:k,eventAction:p("player_load"),eventLabel:b,eventValue:d,nonInteraction:!0}):window._gaq?_gaq.push(["_trackEvent",k,p("player_load"),b,d,!1]):videojs.log("Google Analytics not detected")):void 0}),{sendbeacon:F})})}).call(this);